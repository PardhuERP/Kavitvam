<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin â€“ Post Kavitvam</title>

<style>
body{font-family:Arial;padding:15px;background:#f4f1ec}
input,textarea,select,button{
  width:100%;margin:6px 0;padding:10px;font-size:14px
}
button{background:#6a1b9a;color:#fff;border:none;border-radius:6px}
.hidden{display:none}
</style>
</head>

<body>

<h3>Admin Login</h3>

<div id="loginBox">
  <input id="pin" type="password" placeholder="Admin PIN">
  <button onclick="login()">Login</button>
</div>

<div id="postBox" class="hidden">
  <h3>Post New Kavitvam</h3>

  <input id="title" placeholder="Title">
  <textarea id="text" placeholder="Kavitvam"></textarea>
  <input id="author" placeholder="Author">

  <select id="category">
    <option>Love</option>
    <option>Life</option>
    <option>Devotional</option>
  </select>

  <button onclick="postPoem()">POST</button>
  <button onclick="logout()">Logout</button>
</div>

<script>
const API =
"https://script.google.com/macros/s/AKfycbwTmmsNCd_Ok_Otn38XmikzRBgfeJr35eQul0PA_mC3_eC3jwDJ2vNqWbcUAqCvaQqu/exec";

/* AUTO LOGIN */
if(localStorage.getItem("adminLogged")==="yes"){
  loginBox.classList.add("hidden");
  postBox.classList.remove("hidden");
}

/* LOGIN */
function login(){
  if(pin.value===""){
    alert("Enter PIN");
    return;
  }

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      pin:pin.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="ok"){
      localStorage.setItem("adminLogged","yes");
      loginBox.classList.add("hidden");
      postBox.classList.remove("hidden");
    }else{
      alert("Invalid PIN");
    }
  });
}

/* POST */
function postPoem(){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action:"post",
      title:title.value,
      kavitvam:text.value,
      author:author.value,
      category:category.value
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="ok"){
      alert("Posted successfully");
      title.value="";
      text.value="";
    }else{
      alert("Not Authorized");
    }
  });
}

/* LOGOUT */
function logout(){
  localStorage.removeItem("adminLogged");
  location.reload();
}
</script>

</body>
</html>
