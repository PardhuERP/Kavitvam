<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin â€“ Kavitvam</title>

<style>
body{font-family:Arial;padding:15px}
input,textarea,select,button{
  width:100%;margin:6px 0;padding:10px
}
button{background:#6a1b9a;color:#fff;border:none}
.hidden{display:none}
</style>
</head>

<body>

<h3>Admin Login</h3>

<div id="loginBox">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
</div>

<div id="postBox" class="hidden">
  <h3>Post Kavitvam</h3>

  <input id="title" placeholder="Title">
  <textarea id="text" placeholder="Kavitvam"></textarea>
  <input id="author" placeholder="Author">

  <select id="category">
    <option>Love</option>
    <option>Life</option>
    <option>Devotional</option>
  </select>

  <button onclick="postPoem()">POST</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwTmmsNCd_Ok_Otn38XmikzRBgfeJr35eQul0PA_mC3_eC3jwDJ2vNqWbcUAqCvaQqu/exec";
let ADMIN_TOKEN = "";

/* LOGIN */
function login(){
  fetch(API,{
  method:"POST",
  body:JSON.stringify({
    action:"login",
    email:email.value,
    password:password.value
  })
})
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="ok"){
      ADMIN_TOKEN = res.token;
      loginBox.style.display="none";
      postBox.classList.remove("hidden");
    }else{
      alert("Invalid login");
    }
  });
}

/* POST */
function postPoem(){
  fetch(API,{
  method:"POST",
  body:JSON.stringify({
    action:"post",
    token:ADMIN_TOKEN,
    title:title.value,
    kavitvam:text.value,
    author:author.value,
    category:category.value
  })
})
  .then(r=>r.json())
  .then(res=>{
    if(res.status==="ok"){
      alert("Posted successfully");
      title.value="";
      text.value="";
      author.value="";
    }else{
      alert("Not Authorized");
    }
  });
}
</script>

</body>
</html>
