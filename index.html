<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>Kavitvam</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
/* ===== EXISTING STYLES (UNCHANGED) ===== */
body{margin:0;background:#f4f1ec;font-family:'Noto Serif Telugu',serif;}
header{background:#6a1b9a;color:#fff;padding:14px;text-align:center;font-size:20px;}
body.night{background:#121212;color:#e0e0e0;}
body.night header{background:#1f1f1f;}
body.night .popup-content{background:#1e1e1e;color:#e0e0e0;}
body.night .book-footer,
body.night .popup-author,
body.night .book-date,
body.night .like-count{color:#bbb;}
body.night input{background:#1e1e1e;color:#e0e0e0;border:1px solid #444;}

.search-bar{padding:8px 12px;}
.search-bar input{width:100%;padding:8px 12px;font-size:14px;border-radius:20px;border:1px solid #ccc;}

.category-bar{display:flex;gap:8px;overflow-x:auto;padding:6px 12px 10px;}
.category-btn{padding:6px 14px;border-radius:20px;border:1px solid #ccc;background:#fff;font-size:13px;cursor:pointer;}
.category-btn.active{background:#6a1b9a;color:#fff;}

#loading{text-align:center;padding:15px;color:#888;}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:12px;padding:12px;}
.book{border-radius:8px;padding:10px;height:150px;box-shadow:0 2px 6px rgba(0,0,0,0.15);display:flex;flex-direction:column;justify-content:space-between;}

.book-title{font-weight:bold;font-size:14px;max-height:36px;overflow:hidden;}
.book-footer{font-size:11px;color:#555;}
.book-date{font-size:10px;color:#777;}

.book-like{font-size:16px;align-self:flex-end;cursor:pointer;}
.book-like.liked{color:red;}
.like-count{font-size:11px;margin-left:4px;color:#444;}

.popup{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;}
.popup-content{background:#fff;width:90%;max-height:80%;overflow:auto;padding:18px;border-radius:10px;}
.popup-title{font-size:20px;font-weight:bold;}
.popup-text{margin-top:10px;line-height:1.9;white-space:pre-line;}
.popup-author{margin-top:12px;font-size:13px;color:#666;}
.like-btn{margin-top:12px;font-size:18px;cursor:pointer;}
.like-btn.liked{color:red;font-weight:bold;}
.close{margin-top:15px;text-align:center;color:#6a1b9a;font-weight:bold;cursor:pointer;}

.c1{background:#fff8e1;}
.c2{background:#e3f2fd;}
.c3{background:#e8f5e9;}
.c4{background:#fce4ec;}
.c5{background:#ede7f6;}
.c6{background:#f3e5f5;}

.author-row{display:flex;align-items:center;gap:6px;}
.author-img{width:18px;height:18px;border-radius:50%;object-fit:cover;}

/* ===== NEW: MENU + ADMIN ===== */
#menu{position:fixed;top:12px;left:12px;font-size:22px;cursor:pointer;z-index:20;color:#fff}
#menuBox{position:fixed;top:50px;left:12px;background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.3);display:none;z-index:20}
#menuBox div{padding:10px 14px;cursor:pointer}
#menuBox div:hover{background:#eee}

#postPanel{display:none;padding:12px}
#postPanel input,#postPanel textarea,#postPanel select,#postPanel button{
  width:100%;margin:6px 0;padding:10px
}
#postPanel button{background:#6a1b9a;color:#fff;border:none}

#menu{
  position:fixed;
  top:14px;
  left:12px;
  font-size:22px;
  cursor:pointer;
  z-index:9999;      /* üî• important */
  color:#fff;
}
#menuBox{
  z-index:9999;      /* üî• important */
}
</style>
</head>

<body>

<header>
  ‡∞®‡∞æ ‡∞ï‡∞µ‡∞ø‡∞§‡±ç‡∞µ‡∞Ç
  <span id="modeToggle" style="float:right;cursor:pointer" onclick="toggleMode()">üåô</span>
</header>

<div id="menu" onclick="openMenu()">‚ò∞</div>
<div id="menuBox">
  <div onclick="openLogin()">Login</div>
</div>

<div class="search-bar">
  <input id="searchInput" placeholder="‡∞ï‡∞µ‡∞ø‡∞§‡±ç‡∞µ‡∞Ç ‡∞µ‡±Ü‡∞§‡∞ï‡∞Ç‡∞°‡∞ø..." onkeyup="applySearch()">
</div>

<div class="category-bar" id="categoryBar"></div>

<div id="loading">‡∞ï‡∞µ‡∞ø‡∞§‡±ç‡∞µ‡∞Ç ‡∞≤‡±ã‡∞°‡±ç ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...</div>
<div class="grid" id="grid"></div>

<!-- POPUP (UNCHANGED) -->
<div class="popup" id="popup">
  <div class="popup-content" onclick="event.stopPropagation()">
    <div class="popup-title" id="pTitle"></div>
    <div class="popup-text" id="pText"></div>
    <div class="popup-author" id="pAuthor"></div>
    <div class="like-btn" id="likeBtn" onclick="toggleLike()">ü§ç Like</div>
    <div class="close" onclick="closePopup()">‡∞Æ‡±Ç‡∞∏‡∞ø‡∞µ‡±á‡∞Ø‡∞ø</div>
  </div>
</div>

<!-- LOGIN POPUP -->
<div class="popup" id="loginPopup">
  <div class="popup-content">
    <h3>Admin Login</h3>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div class="close" onclick="closeLogin()">Close</div>
  </div>
</div>

<!-- ADMIN POST PANEL -->
<div id="postPanel">
  <h3>Post New Kavitvam</h3>
  <input id="ptitle" placeholder="Title">
  <textarea id="ptext" placeholder="Kavitvam"></textarea>
  <input id="pauthor" placeholder="Author">
  <select id="pcategory">
    <option>Love</option>
    <option>Life</option>
    <option>Devotional</option>
  </select>
  <button onclick="postPoem()">POST</button>
</div>

<script>
/* ===== EXISTING JS (UNCHANGED CORE LOGIC) ===== */
const API="YOUR_APPS_SCRIPT_URL";
  const menu = document.getElementById("menu");
const menuBox = document.getElementById("menuBox");
document.addEventListener("click", function(e){
  if(!menu.contains(e.target) && !menuBox.contains(e.target)){
    menuBox.style.display = "none";
  }
});

let poems=[],filteredPoems=[],currentList=[],currentIndex=null,selectedCategory="All";

fetch(API+"?t="+Date.now()).then(r=>r.json()).then(d=>{
  poems=d.reverse();loading.style.display="none";buildCategories();render();
});

function render(){
  let likes=JSON.parse(localStorage.getItem("likes")||"{}");
  let counts=JSON.parse(localStorage.getItem("likeCounts")||"{}");
  currentList=filteredPoems.length?filteredPoems:poems;
  grid.innerHTML=currentList.map((p,i)=>`
    <div class="book c${i%6+1}">
      <div class="book-title" onclick="openPoem(${i})">${p.title}</div>
      <div class="book-footer" onclick="openPoem(${i})">
        <div class="author-row">
          <span>‚úç ${p.author}</span>
          <img src="author.png" class="author-img">
        </div>
        <span class="book-date">üìÖ ${formatDate(p.date)}</span>
      </div>
      <div class="book-like ${likes[i]?'liked':''}" onclick="toggleLikeFromBook(event,${i})">
        ${likes[i]?'‚ù§Ô∏è':'ü§ç'} <span class="like-count">${counts[i]||0}</span>
      </div>
    </div>`).join("");
}

function openPoem(i){
  currentIndex=i;
  let p=currentList[i];
  pTitle.innerText=p.title||"";
  pText.innerText=p.kavitvam||"";
  pAuthor.innerText="‚úç "+p.author+" | "+formatDate(p.date);
  updateLikeUI();
  popup.style.display="flex";
}
function closePopup(){popup.style.display="none";}

/* ===== MENU + ADMIN (NEW, ADDITIVE) ===== */
function openMenu(){menuBox.style.display=menuBox.style.display==="block"?"none":"block";}
function openLogin(){menuBox.style.display="none";loginPopup.style.display="flex";}
function closeLogin(){loginPopup.style.display="none";}

function login(){
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"login",email:email.value,password:password.value
  })})
  .then(r=>r.json()).then(res=>{
    if(res.status==="ok"){
      localStorage.setItem("adminToken",res.token);
      loginPopup.style.display="none";
      postPanel.style.display="block";
    }else alert("Invalid login");
  });
}

function postPoem(){
  fetch(API,{method:"POST",body:JSON.stringify({
    action:"post",
    token:localStorage.getItem("adminToken"),
    title:ptitle.value,kavitvam:ptext.value,
    author:pauthor.value,category:pcategory.value
  })})
  .then(r=>r.json()).then(res=>{
    if(res.status==="ok"){alert("Posted");location.reload();}
    else alert("Not authorized");
  });
}

if(localStorage.getItem("adminToken")) postPanel.style.display="block";

/* ===== DATE FIX ===== */
function formatDate(d){
  if(!d) return "";
  if(d.includes("T")){
    let [y,m,da]=d.substring(0,10).split("-");
    let f=new Date(y,m-1,parseInt(da)+1);
    return f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0");
  }
  return d;
}
</script>

</body>
</html>
